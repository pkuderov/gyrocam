Вопросы:
 * "Manhattan World" - переводить, нет?
 * стоит ли рядом с понятиями, методами, названиями чего-либо важного приводить в скобочках оригинальное и/или популярное название на ин.яз.?
Ответы:
---------------------------------------------------

Активно развивается область, связанная с созданием автономных роботов, транспортных средств. Область широкая и давно вышла за рамки военных нужд - высок интерес со стороны промышленности и населения (нужно про это вообще писать?). бла-бла-бла
Собственное движение автотехники полагается на системы позиционирования. 
Распространенные способы построения подобных систем: 
 * сонары и т.п.
 * гироскопы на основе инерциальных датчиков. Проблема –  накопление ошибки со временем.
 * системы глобального (спутникового) наведения – низкая точность в местах густой застройки, под кронами деревьев, под мостами (так ли это? да!), низкая точность в принципе при условии использования недорогих приемников и/или при небольших размерах (относительно максимально возможной точности) самого объекта.
Навигацию можно условно разделить на глобальную – определение абсолютных координат, локальную – определение координат относительно некоторых точек и персональную – позиционирование собственных частей, а так же на активную – координаты определяет сам объект навигации и пассивную – получение собственных координат извне.

Набирает популярность использование методов компьютерного зрения. Видеодатчики имеют маленький размер, энергопотребление, цену => есть интерес использовать их в системах позиционирования и навигации. Камеры потребительского класса легко доступны, для тестирования методов можно использовать их, в том числе камеры мобильных телефонов. Датчики на основе анализа изображений не имеют проблемы ИНС - накопления ошибки, при этом может достигаться довольно хорошая точность, сравнимая с датчиками гироскопов потребительского класса.
Популярные решения:
 * SLAM(simultaneous localization and mapping, метод одновременной навигации и составления карты / картирования) - используют Particle filters / Sequential Monte Carlo(SMC) или расширенный фильтр Калмана
 * SfM (Structure from motion) - видимо, то же, что и 3D reconstruction from 2D images.
Оба решения похожи тем, что они пытаются построить 3D модель окружающей среды, относительно которой происходит движение камеры.

Другой вариант – построение гироскопа на основе определения трехмерной ориентации по изображению без воссоздания модели окружающей среды. Данный метод основан на отслеживании ТСП по обнаруженным на изображении СЛ в условиях "Manhattan World" (во введении своими словами, а где-то дальше приткнуть про мв)
/* 
вот тут стоит кратко в 2-3 предложения описать, что такое "Manhattan World" и далее стараться его не касаться:
 * wiki http://en.wikipedia.org/wiki/User:Paulpop
 * probably original of such concept (pdf) http://papers.nips.cc/paper/1804-the-manhattan-world-assumption-regularities-in-scene-statistics-which-enable-bayesian-inference.pdf
*/

Плюсы конкретно данного метода:
 * в условиях "Manhattan World" изобилие линейных объектов правильной геометрической формы позволяет достигнуть высокой точности
 * число интересующих нас ТСП ограничено <= 3
 * ТСП не зависят от положения камеры - только от ее ориентации
 * робастность относительно случайных нестационарных объектов, попадающих в кадр (люди, транспортные средства и т.п.)

Методы на основе определения ТСП используются для:
 * навигации автономных транспортных средств, роботов
 * 3D реконструкции окружающей среды в условиях "Manhattan World"
 * калибровка камер и коррекция изображений


Метод коротко:
 * выделение сегментов линий на изображении
 * выделение наилучших кластеров СЛ, сходящихся в одной точке (или бесконечности), используя алгоритм RANSAC
 * (не работает) приведение координат сегментов линий в нормализованные координаты путем домножения слева на обратную матрицу калибровки
 * вычисление вектора направления ТСП на основе полученных кластеров СЛ путем приближенного решения задачи минимизации Ax = 0 методом SVD декомпозиции матрицы A
 * ортогонализация матрицы, составленной из векторов направлений ТСП
 * (нет) получение углов (крен, тангаж, рыскание) из матрицы поворота
 * (нет) связывание матриц поворота и кормление их расширенному фильтру Калмана (omgwtf)
 
Входные данные алгоритма - изображение с условием "Manhattan World".
Первым этапом является выделение сегментов линий на изображении. Для решения данной задачи в оригинальной статье предлагается использовать метод Джиои и ... (Link4). (проверить, что написано во введение самой статьи Джиои) Это довольно новый алгоритм, отличающийся высокой скоростью за счет линейной зависимости сложности от размеров изображения по сравнению с другими алгоритмами, основанных на анализе связанных компонент градиента изображения. По быстродействию он уступает алгоритмам, основанным на преобразовании Хафа (Hough), но позволяет достичь более высокого качества.
В своем приложении я использовал реализацию алгоритма Джиои в библиотеке opencv версии 3.0.0. Ему отвечает класс cv::LineSegmentDetector (LSD), который принимает на вход изображение в градациях серого (в opencv тип CV_8UC1), и различные параметры настройки алгоритма. В своем приложении в качестве параметров настройки я использовал рекомендованные по умолчанию. 
Результатом работы модуля LSD является список найденных сегментов линий. Для каждого сегмента дается следующая информация:
 * координаты концов в пикселах в виде четверки целых чисел (тип данных opencv Vec4i)
 * ширина линии
 * точность, с которой он найден
 * число ложных срабатываний (number of false alarms) в области сегмента линии в виде логарифмической шкалы качества детектирования

Получив результат работы детектора сегментов линий, я провожу фильтрацию сегментов по длине, отбрасывая слишком короткие меньше 20 символов. Во-первых, это позволяет значительно ускорить работу на последующих этапах. Во-вторых, мною было замечено, что короткие сегменты чаще относятся к ошибочным направлениям (не к искомым ТСП). Те же, что относятся к искомым ТСП за счет своей длины ухудшают точность вычислений, т.к. погрешность детектора в обнаружении одного из концов отрезка в 1 пиксел ведет к достаточно большой итоговой угловой погрешности.  
Далее я провожу подготовку структур данных к последующим этапам работы алгоритма, создавая на основе каждого отрезка, представленного четверкой целых чисел, объект структуры LineSegment, вычисляю и сохраняю следующие поля:
 * оригинальную четверку координат концов, полученных в виде объекта структуры Vec4i
 * координаты точек концов отрезка в нормализованных координатах и удобном формате типа cv::Point3d
 * середину отрезка в нормализованных координатах
 * уравнение линии, которую задает сегмент, в нормализованных координатах. Уравнение вычисляется как векторное произведение точек концов отрезка
 
Далее, я провожу кластеризацию сегментов линий, используя адаптивный алгоритм RANSAC. На каждом прогоне алгоритма вычисляется самый большой оставшийся кластер сегментов, линии которых пересекаются в одной точке с некоторой допустимой погрешностью. Полученный кластер объявляется соответствующим некоторой ТСП. Всего производится 3 запуска алгоритма.
Алгоритм состоит из последовательности итераций, состоящих из следующих шагов:
 * случайным образом выбирается пара сегментов линий
 * вычисляется точка их пересечения, которая объявляется потенциальной ТСП
 * далее проводится каждого сегмента линии на предмет принадлежности его потенциальной ТСП путем вычисления функция расстояния до ТСП по формуле:
	
		Point3d l = lineThroughPoints(segment.middle, vp);
		double d = incidence(l, segment.from) / norm12(l);
		return abs(d) <= distanceEpsilon 
			&& abs(asin(d / norm(segment.middle - segment.from))) <= angleEpsilon;
			
, где 
	static const double distanceEpsilon = 2; // 2 pixel
	static const double angleEpsilon = 0.04; // ~1% pi or ~2 degree
Таким образом для имеющейся потенциальной ТСП определяется множество соответствующих ей сегментов. Назовем содержащиеся в нем сегменты внутренними, а все остальные - внешними по отношению к данной vp. Обозначим также их отношение как r. Чем выше число r, тем более подходящей считается ТСП.
Число итераций алгоритма определяется адаптивно следующим образом. Определим число итераций k, необходимых, чтобы гарантировать с вероятностью p, что хотя бы одна потенциальная ТСП, случайно выбранная алгоритмом RANSAC, не содержит внешних сегментов линий. Вероятность выбора k ТСП по крайней мере с одним внешним сегментом в каждой из них составляет (1 - r^2)^k (подтвердить). Число итераций, необходимых, чтобы гарантировать вероятность ниже порога 1 - p: 
	k >= log(1 - p) / log (1 - r^2)
Хотя истинное значение r и неизвестно, его можно аппроксимировать снизу наилучшим из найденных за предыдущие итерации r.
После каждого запуска алгоритма RANSAC внутренние сегменты для найденной ТСП удаляются из выборки и в последующих запусках не участвуют. В итоге после 3х последовательных запусков алгоритма мы имеем 3 кластера сегментов линий, каждому из которых соответствует довольно грубая оценка ТСП.

Теория:
1. Геометрия ТСП
Теория точек схождения перспективы (ТСП) рассматривается обычно в терминах проективной геометрии, изучающей геометрические свойства, являющихся инвариантными относительно проективных преобразований, а также сами эти преобразования. Проецирование трехмерной сцены на двухмерную плоскость изображения, осуществляемое фото- или видеокамерой, – одно из таких преобразований.
В проективной геометрии точки представлены в однородных координатах. Например, рассмотрим точку в двухмерном евклидовом пространстве (x, y) @ R2. Чтобы представить ее на проективной плоскости, необходимо лишь добавить третью компоненту z, равную 1, т.е. (x, y, 1) @ P2. Более того, для любого ненулевого a (ax, ay, a) = (x, y, 1). В случае нулевого a координаты точки вырождаются в точку (0, 0, 0), которая не включена в P2.
Рассмотрим уравнение прямой на двухмерной евклидовой плоскости:
	ax + by + c = 0
Точки (x, y), и только они, удовлетворяющие данному уравнению являются лежащими на данной прямой. Теперь заметим, что уравнение (*) можно переписать следующим образом:
	ax + by + c*1 = aX + bY + cZ = 0
Таким образом мы определили все точки (x, y, 1) = (X / Z, Y / Z, 1) = (X, Y, Z) проективного пространства, лежащие на прямой. Заметим также, что aX + bY + cZ = l * p = 0, где l = (a, b, c), p = (X, Y, Z), a * - скалярное произведение. Во-первых, важным свойством проективной геометрии является то, что уравнение линии задается вектором той же размерности, что и точки. Во-вторых, имеет место весьма красивое и простое выражение связывающее точки и проходящие через них линии.
Не вдаваясь в подробности, запишем это и другие важные уравнения проективной геометрии, которые так или иначе понадобятся нам в работе:
 * проверка принадлежности точки прямой incidence(p1, p2) = p1 * p2
 * прямая через две точки ltp(p1, p2) = p1 x p2, где x - векторное произведение
 * точка пересечения двух прямых intersection(l1, l2) = l1 x l2

Чтобы вернуться из P2 обратно в R2, достаточно поделить координаты точки на z-координату, то есть (X, Y, Z) = (X / Z, Y / Z, 1) = (x, y, 1) @ P2 ~ (x, y) @ R2. Из данной процедуры сразу видно, что P2 ( R2, так как содержит элементы с z = 0. Эти точки составляют довольно важно подмножество P2 и называются идальными. Еще их называют точками в бесконечности, так как они соответствуют предельным точкам, лежащим бесконечно далеко от начала координат. Несмотря на свой особый вид, данные точки никаким специальным образом не обрабатываются, то есть рассматриваются абсолютно также как и обычные. Все идеальные точки лежат на идеальной прямой или прямой в бесконечности.

Также заметим, что точкам p(X, Y, Z) = (x, y, 1) @ P2 можно поставить в соответствие прямую, проходящую через начало координат и точку p`(x, y, 1) @ R3 с выколотой точкой (0, 0, 0). Таким же образом линия l(a, b, c) на проективной плоскости может быть визуализирована в R3 плоскостью, образованной началом координат и перпендикуляром к l`(a, b, c). Тогда точкам с координатами (x, y, 1) в R3 соответствует плоскость Z = 1, идеальным точкам соответствуют точки на Z = 0, а идеальной прямой сама плоскость Z = 0.
Данная связь между R3 и P2 может быть легко продолжена до связи между P3 (добавлением к точкам R3 четвертой координаты 1) и P2. Такая связь очень хорошо подходит для описания преобразования проецирования трехмерной сцены на двухмерную плоскость изображения. 

Одна из самых простых и обычно используемых моделей для конечной проективной камеры - модель булавочного отверстия или модель камеры обскуры (pinhole camera):
	F: P3 -> P2, F(X) = KR[I3 - t)X,
где K @ R3x3 - матрица калибровки камеры, R @ R3x3 - матрица ортогонального поворота, t @ R3 - вектор смещения камеры в мировой системе координат.
Матрица калибровки K является верхней треугольной матрицей, задающей характерные (intrinsic) параметры камеры:
K = [ f/mx s    px ]
    [ 0    f/my py ]
	[ 0    0    1  ]
, где 
	* f - фокусное расстояние камеры в некоторой единице длины, 
	* mx, my - линейные размеры пиксела, выраженные в той же единице длины, что и f. Таким образом f / mx и f / my имеют размерность пикселов,
	* s - коэффициент ассиметрии камеры
	* px, py - координаты главной точки (principal point) - центра матрицы камеры, который может не совпадать с центром изображения.
	
Большинство цифровых камер на основе приборов с зарядовой связью (ПЗС) имеют квадратные пикселы (mx = my), нулевую ассиметрию (s = 0) и главную точку, расположенную близко к центру изображения
Обычно mx и my равны и вместо них используют коэффициент их отношения , т.е. пикселы имеют квадратную форму, но бывают случаи, когда это не так.

1.1. Проективное преобразование и однородные координаты, модель булавочного отверстия, ТСП

2. Обнаружение ТСП
2.1. Обнаружение СЛ. Вкратце преобразование Хо (Хаф, Hough Transform) и анализ связанных компонент ориентаций градиента изображения, возможно про Canny детектор, кратко про LSD (pdf)
Выбрали  анализ ... почему?
Lsd - O(img.size()), but slower than Hough
2.2. Кластеризация СЛ. RANSAC, можно (нужно! но, возможно, не здесь, а дальше в "что можно улучшить") заикнуться про J-Linkage (введение в статье pdf - сравниваются разные способы кластеризации)
RANSAC выбрали, потому что популярное решение.
Расписать функцию расстояния d(vp,l), как в статье, как делаю я.
Расписать как выбирается число итераций алгоритма (вывод формулы)
На данном этапе выработана грубая оценка ТСП
2.3. Уточнение ТСП
Описать математически текущую ситуацию - пучок линий сходится примерно в одной точке. Какое уравнение связывает их в идеале.
Значит решаем Ax = 0 приближенно. Что делать, если система не переопределена (у меня сейчас просто упадет программа!)?
Какие существуют способы приближенного решения данной задачи? LSQM, SVD, smth else
Почему мы не решаем ее тут, а переходим в нормализованные координат изображения? Что это такое вообще, зачем? В честь кого это делается? [Cipolla]
Получили нулевые направления, что дальше?
2.4. Определение ориентации по ТСП
Есть матрица D = [d1, d2, d3]. Если только две приблизительно ортогональны (или 3ей не нашли вообще), 3ю вычисляем на основе их через векторное произведение.
Объясняю, что D скорее всего не ортогональна => можно ортогонализовать. Как? SVD! D' = u * vt
Приводим матрицу нулевых направлений 

Матрица относительного поворота R = D2 D1t
At = A-1, т.к. ортогональная => alpha(R) = alpha(D2) + alpha(D1t) = alpha(D2) - alpha(D1)

Расширенный фильтр Калмана (http://en.wikipedia.org/wiki/Extended_Kalman_filter): 
In estimation theory, the extended Kalman filter (EKF) is the nonlinear version of the Kalman filter which linearizes about an estimate of the current mean and covariance. In the case of well defined transition models, the EKF has been considered[1] the de facto standard in the theory of nonlinear state estimation, navigation systems and GPS
Disadvantages of the extended Kalman filter
Unlike its linear counterpart, the extended Kalman filter in general is not an optimal estimator (of course it is optimal if the measurement and the state transition model are both linear, as in that case the extended Kalman filter is identical to the regular one). In addition, if the initial estimate of the state is wrong, or if the process is modeled incorrectly, the filter may quickly diverge, owing to its linearization. Another problem with the extended Kalman filter is that the estimated covariance matrix tends to underestimate the true covariance matrix and therefore risks becoming inconsistent in the statistical sense without the addition of "stabilising noise".

SfM:
Structure from motion (SfM) is a range imaging technique; it refers to the process of estimating three-dimensional structures from two-dimensional image sequences which may be coupled with local motion signals. It is studied in the fields of computer vision and visual perception. In biological vision, SfM refers to the phenomenon by which humans (and other living creatures) can recover 3D structure from the projected 2D (retinal) motion field of a moving object or scene.